<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karishma: Diagnostic Tool</title>
<style>
    body { background: #1a1a1a; color: white; font-family: monospace; padding: 20px; text-align: center; }
    #karishma { font-size: 80px; margin-bottom: 20px; animation: bounce 2s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-20px);} }
    
    .chat-box { 
        background: #333; width: 90%; max-width: 500px; height: 300px; 
        margin: 0 auto; border-radius: 10px; overflow-y: auto; padding: 20px; 
        border: 2px solid #555; text-align: left;
    }
    .msg { margin-bottom: 10px; padding: 8px; border-radius: 5px; }
    .bot { background: #444; color: #fff; }
    .user { background: #ff4081; color: #fff; text-align: right; }
    .error-box { background: #ff5252; color: white; padding: 15px; margin-top: 10px; border-radius: 5px; display: none; }
    
    input { padding: 10px; width: 70%; border-radius: 5px; border: none; margin-top: 20px; }
    button { padding: 10px 20px; background: #ff4081; color: white; border: none; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>

    <div id="karishma">üéÄ</div>
    <h3>Karishma Connection Test</h3>
    
    <div class="chat-box" id="chat">
        <div class="msg bot">System Initialized. Type 'Hi' to test connection.</div>
    </div>

    <div id="error-display" class="error-box"></div>

    <div>
        <input type="text" id="inp" placeholder="Type Hi..." onkeypress="if(event.key==='Enter') testConnection()">
        <button onclick="testConnection()">Send</button>
    </div>

<script>
    // --- PASTE YOUR KEY HERE FOR TESTING ---
    const API_KEY = "AIzaSyDqcavif5UfWGLY1w7YCmR-Oi2Anz9GloU"; 
    
    // Using the most basic model
    const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

    async function testConnection() {
        const inp = document.getElementById("inp");
        const text = inp.value;
        if(!text) return;
        
        // UI Updates
        const chat = document.getElementById("chat");
        chat.innerHTML += `<div class="msg user">${text}</div>`;
        chat.innerHTML += `<div class="msg bot">Testing Connection...</div>`;
        document.getElementById("error-display").style.display = 'none';
        inp.value = "";

        // MINIMAL PAYLOAD (No complex settings)
        const payload = {
            contents: [{
                parts: [{ text: "You are Karishma. Say hello nicely. User says: " + text }]
            }]
        };

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            // 1. CHECK HTTP ERRORS
            if (!response.ok) {
                throw new Error(`Google Error (${response.status}): ${data.error?.message || response.statusText}`);
            }

            // 2. SUCCESS
            if (data.candidates && data.candidates.length > 0) {
                const reply = data.candidates[0].content.parts[0].text;
                chat.innerHTML += `<div class="msg bot">‚úÖ Success: ${reply}</div>`;
            } else {
                throw new Error("No response candidates returned.");
            }

        } catch (error) {
            // 3. SHOW THE REAL ERROR
            console.error(error);
            const errBox = document.getElementById("error-display");
            errBox.style.display = 'block';
            errBox.innerHTML = `<strong>CONNECTION FAILED</strong><br>${error.message}`;
            
            chat.innerHTML += `<div class="msg bot">‚ùå Failed. See red box below.</div>`;
        }
    }
</script>

</body>
</html>
