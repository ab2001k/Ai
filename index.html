<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Karishma: Ultimate Edition</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ€</text></svg>">

<style>
    /* --- CORE VARIABLES --- */
    :root {
        --sky-day: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
        --sky-night: linear-gradient(180deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        --robot-main: #ff4081; 
        --robot-light: #ff80ab;
        --robot-dark: #c51162;
    }

    body {
        margin: 0; overflow: hidden; background: #000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        touch-action: manipulation;
    }

    /* --- WORLD LAYERS --- */
    .scene {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--sky-day);
        transition: background 1.5s ease;
        z-index: 1; overflow: hidden;
    }
    .scene.night { background: var(--sky-night); }

    /* --- SKY OBJECTS --- */
    .celestial {
        position: absolute; top: 30px; right: 30px; width: 80px; height: 80px;
        z-index: 2; transition: transform 0.5s; cursor: pointer;
    }
    .celestial:active { transform: scale(0.9); }
    
    .sun {
        width: 100%; height: 100%; background: #ffeb3b; border-radius: 50%;
        box-shadow: 0 0 40px #ffeb3b; animation: spin 20s linear infinite;
    }
    .moon {
        width: 100%; height: 100%; background: transparent; border-radius: 50%;
        box-shadow: -20px 10px 0 5px #f4f6f8; display: none;
    }
    .scene.night .sun { display: none; }
    .scene.night .moon { display: block; }

    /* Clouds */
    .cloud {
        position: absolute; background: #fff; border-radius: 50px; opacity: 0.8;
        animation: floatCloud 40s linear infinite; z-index: 2;
    }
    .c1 { width: 120px; height: 50px; top: 10%; left: -20%; }
    .c2 { width: 80px; height: 30px; top: 20%; left: -10%; animation-delay: 10s; }
    @keyframes floatCloud { 0% { left: -20%; } 100% { left: 120%; } }
    .scene.night .cloud { opacity: 0.1; }

    /* Stars (Generated by JS) */
    .star {
        position: absolute; width: 3px; height: 3px; background: #fff; border-radius: 50%;
        opacity: 0; transition: opacity 1s;
    }
    .scene.night .star { opacity: 0.8; }

    /* --- MOUNTAINS (SVG) --- */
    .mountains-container {
        position: absolute; bottom: 25%; left: 0; width: 100%; height: 50%;
        z-index: 2; pointer-events: none;
    }
    .mountain-svg {
        width: 100%; height: 100%;
        filter: drop-shadow(0 0 10px rgba(0,0,0,0.2));
    }
    .scene.night .mountain-svg path { fill: #1a237e; stroke: none; } /* Darker at night */

    /* --- GROUND --- */
    .ground {
        position: absolute; bottom: 0; width: 100%; height: 30%;
        background: linear-gradient(to bottom, #76b852, #8DC26F);
        z-index: 3;
        border-top: 6px solid #a8e063;
    }
    .scene.night .ground { filter: brightness(0.3); }

    /* --- HOUSE (Advanced) --- */
    .house-group {
        position: absolute; bottom: 25%; left: 5%;
        z-index: 4; cursor: pointer; transition: transform 0.2s;
    }
    .house-group:active { transform: scale(0.95); }
    
    .house-base {
        width: 140px; height: 120px; background: #ffccbc;
        border: 4px solid #5d4037; position: relative;
        box-shadow: 10px 10px 20px rgba(0,0,0,0.3);
    }
    .window {
        width: 40px; height: 40px; background: #81d4fa;
        border: 3px solid #5d4037; position: absolute; top: 20px; right: 20px;
        box-shadow: inset 0 0 10px rgba(255,255,255,0.5);
    }
    .window::after { content:''; position: absolute; top: 50%; left: 0; width: 100%; height: 3px; background: #5d4037; }
    .window::before { content:''; position: absolute; left: 50%; top: 0; height: 100%; width: 3px; background: #5d4037; z-index: 1; }
    .door {
        width: 40px; height: 60px; background: #795548;
        position: absolute; bottom: 0; left: 20px;
        border-top-left-radius: 20px; border-top-right-radius: 20px;
        border: 3px solid #3e2723;
    }
    .roof {
        width: 0; height: 0; position: absolute; top: -80px; left: -20px;
        border-left: 90px solid transparent; border-right: 90px solid transparent;
        border-bottom: 80px solid #d32f2f;
        filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
    }
    .chimney {
        width: 25px; height: 40px; background: #5d4037;
        position: absolute; top: -60px; right: 20px;
    }
    .smoke {
        position: absolute; top: -70px; right: 25px;
        width: 15px; height: 15px; background: rgba(255,255,255,0.8);
        border-radius: 50%; animation: smokeAnim 3s infinite; opacity: 0;
    }
    @keyframes smokeAnim { 
        0% { transform: translateY(0) scale(1); opacity: 0.8; } 
        100% { transform: translateY(-50px) scale(2); opacity: 0; } 
    }

    /* --- ROBOT (Dynamic & Cute) --- */
    .robot-wrapper {
        position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
        z-index: 10; display: flex; flex-direction: column; align-items: center;
        animation: float 4s ease-in-out infinite;
    }
    @keyframes float { 0%,100%{transform:translateX(-50%) translateY(0);} 50%{transform:translateX(-50%) translateY(-15px);} }

    .part-click { cursor: pointer; transition: 0.1s; }
    .part-click:active { filter: brightness(1.2); transform: scale(0.95); }

    .r-head {
        width: 120px; height: 100px; background: var(--robot-main);
        border-radius: 40px; border: 5px solid #fff;
        position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        z-index: 2;
    }
    .r-face-screen {
        width: 90px; height: 50px; background: #222;
        border-radius: 20px; margin: 25px auto 0;
        display: flex; justify-content: space-around; align-items: center;
        border: 2px solid #555;
    }
    .r-eye {
        width: 15px; height: 25px; background: #00e5ff;
        border-radius: 10px; animation: blink 4s infinite;
        box-shadow: 0 0 10px #00e5ff;
    }
    @keyframes blink { 0%,48%,52%,100%{height:25px;} 50%{height:2px;} }

    .r-antenna {
        width: 6px; height: 30px; background: #888;
        position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
    }
    .r-bulb {
        width: 16px; height: 16px; background: #ffeb3b;
        border-radius: 50%; position: absolute; top: -10px; left: -5px;
        animation: glow 2s infinite alternate;
    }
    @keyframes glow { from{box-shadow:0 0 5px #ffeb3b;} to{box-shadow:0 0 20px #ffeb3b;} }

    .r-body {
        width: 80px; height: 90px; background: var(--robot-main);
        border-radius: 25px; margin-top: -15px; border: 5px solid #fff;
        z-index: 1; display: flex; justify-content: center; align-items: center;
    }
    .r-heart { font-size: 40px; color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }

    .r-arm {
        width: 20px; height: 60px; background: var(--robot-light);
        border: 3px solid #fff; border-radius: 10px;
        position: absolute; top: 100px;
    }
    .r-arm.left { left: -25px; transform: rotate(20deg); }
    .r-arm.right { right: -25px; transform: rotate(-20deg); }

    .dance { animation: danceMove 0.5s infinite; }
    @keyframes danceMove { 0%,100%{transform:translateX(-50%) rotate(0);} 25%{transform:translateX(-50%) rotate(-10deg);} 75%{transform:translateX(-50%) rotate(10deg);} }

    /* --- SIGNPOST --- */
    .sign-group {
        position: absolute; bottom: 15%; right: 10%; z-index: 5;
        cursor: pointer; transform: rotate(5deg);
    }
    .board {
        background: #ffb74d; border: 3px solid #e65100;
        padding: 8px; border-radius: 5px; text-align: center;
        font-weight: bold; font-size: 14px; color: #bf360c;
        box-shadow: 3px 3px 5px rgba(0,0,0,0.3);
    }
    .pole { width: 8px; height: 60px; background: #5d4037; margin: 0 auto; }

    /* --- CHAT UI --- */
    .chat-wrapper {
        position: fixed; bottom: 0; left: 0; width: 100%; height: 40vh;
        z-index: 100; pointer-events: none;
        display: flex; justify-content: center;
    }
    .chat-box {
        pointer-events: auto;
        width: 95%; max-width: 500px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-top-left-radius: 20px; border-top-right-radius: 20px;
        box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
        display: flex; flex-direction: column; overflow: hidden;
    }
    .chat-header {
        background: var(--robot-main); color: white; padding: 10px;
        text-align: center; font-weight: bold; font-size: 14px;
        display: flex; justify-content: space-between; align-items: center;
    }
    .chat-history {
        flex: 1; overflow-y: auto; padding: 15px;
        display: flex; flex-direction: column; gap: 10px;
    }
    .msg {
        padding: 8px 12px; border-radius: 12px; font-size: 14px; max-width: 80%;
        animation: pop 0.3s ease;
    }
    @keyframes pop { from{transform:scale(0);} to{transform:scale(1);} }
    .u-msg { align-self: flex-end; background: #333; color: #fff; border-bottom-right-radius: 2px; }
    .b-msg { align-self: flex-start; background: #f1f1f1; color: #333; border-bottom-left-radius: 2px; border: 1px solid #ddd; }

    .input-area {
        padding: 10px; background: #f9f9f9; display: flex; gap: 10px;
        border-top: 1px solid #ddd;
    }
    input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
    button {
        background: var(--robot-main); color: white; border: none;
        padding: 0 20px; border-radius: 20px; font-weight: bold; cursor: pointer;
    }

    #status-bar {
        position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
        background: #333; color: #fff; padding: 5px 15px; border-radius: 20px;
        font-size: 12px; z-index: 200; opacity: 0; transition: opacity 0.5s;
    }
</style>
</head>
<body>

<div class="scene" id="scene">
    <div class="celestial" onclick="toggleTime()">
        <div class="sun"></div>
        <div class="moon"></div>
    </div>

    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div id="stars-container"></div>

    <div class="mountains-container">
        <svg class="mountain-svg" viewBox="0 0 1000 300" preserveAspectRatio="none">
            <path d="M0,300 L150,50 L300,300 L450,100 L600,300 L750,20 L1000,300 Z" fill="#9c27b0" opacity="0.8"></path>
            <path d="M-100,300 L200,150 L500,300 L700,120 L1100,300 Z" fill="#673ab7" opacity="0.6"></path>
        </svg>
    </div>

    <div class="ground"></div>

    <div class="house-group" onclick="interact('house')">
        <div class="roof"></div>
        <div class="chimney"></div>
        <div class="smoke"></div>
        <div class="house-base">
            <div class="window"></div>
            <div class="door"></div>
        </div>
    </div>

    <div class="sign-group" onclick="interact('sign')">
        <div class="board">Code By<br>Abhik Dutta</div>
        <div class="pole"></div>
    </div>
</div>

<div class="robot-wrapper" id="karishma">
    <div class="r-head part-click" onclick="interact('head')">
        <div class="r-antenna"><div class="r-bulb"></div></div>
        <div class="r-face-screen">
            <div class="r-eye"></div><div class="r-eye"></div>
        </div>
    </div>
    <div class="r-body part-click" onclick="interact('tummy')">
        <div class="r-heart">â™¥</div>
    </div>
    <div class="r-arm left part-click" onclick="interact('hand')"></div>
    <div class="r-arm right part-click" onclick="interact('hand')"></div>
</div>

<div id="status-bar">Connecting...</div>

<div class="chat-wrapper">
    <div class="chat-box">
        <div class="chat-header">
            <span>ðŸŽ€ Karishma AI</span>
            <span style="font-size:10px; cursor:pointer;" onclick="reset()">RESET</span>
        </div>
        <div class="chat-history" id="chatList"></div>
        <div class="input-area">
            <input type="text" id="inp" placeholder="Type here..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">âž¤</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // YOUR NEW API KEY
    // ==========================================
    const API_KEY = "AIzaSyDqcavif5UfWGLY1w7YCmR-Oi2Anz9GloU"; 
    
    // Safety list: If one version isn't ready in your region, it tries the others.
    const MODELS = ["gemini-1.5-flash", "gemini-1.5-flash-001", "gemini-1.5-pro", "gemini-pro"];
    
    const SYSTEM_PROMPT = "You are Karishma, a cute robot girl. Your creator is Abhik Dutta. Keep replies short (max 15 words) and use emojis.";
    let history = [];

    // --- INIT ---
    window.onload = function() {
        // Auto set night based on hour
        const h = new Date().getHours();
        if(h >= 18 || h < 6) toggleTime(true);
        generateStars();
        
        addMsg('bot', "Hi! I am Karishma. I am ready! ðŸŽ€");
    };

    function reset() {
        history = [];
        document.getElementById('chatList').innerHTML = '';
        addMsg('bot', "Memory cleared! ðŸ§¹");
    }

    // --- VISUALS ---
    function toggleTime(forceNight = false) {
        const scene = document.getElementById('scene');
        const isNight = scene.classList.contains('night');
        
        if (!isNight || forceNight) {
            scene.classList.add('night');
        } else {
            scene.classList.remove('night');
        }
    }

    function generateStars() {
        const cont = document.getElementById('stars-container');
        for(let i=0; i<30; i++) {
            let s = document.createElement('div');
            s.className = 'star';
            s.style.left = Math.random()*100 + '%';
            s.style.top = Math.random()*50 + '%';
            cont.appendChild(s);
        }
    }

    // --- INTERACTION ---
    function interact(type) {
        // Animation
        const r = document.getElementById('karishma');
        r.classList.add('dance');
        setTimeout(()=>r.classList.remove('dance'), 1000);

        // Smart Reply Logic (Hidden Prompts)
        let txt = "";
        if(type === 'sign') txt = "User pointed at the sign 'Code by Abhik Dutta'. Praise Abhik enthusiasticly.";
        if(type === 'head') txt = "User patted your head. React cutely.";
        if(type === 'tummy') txt = "User poked your tummy. Giggle.";
        if(type === 'house') txt = "User pointed at your house. Welcome them.";
        if(type === 'hand') txt = "User shook your hand. Say hello.";

        callAI(txt, true); // true = hidden context
    }

    // --- CHAT LOGIC ---
    function addMsg(role, text) {
        const div = document.createElement('div');
        div.className = `msg ${role === 'user' ? 'u-msg' : 'b-msg'}`;
        div.innerText = text;
        const list = document.getElementById('chatList');
        list.appendChild(div);
        list.scrollTop = list.scrollHeight;
    }

    async function send() {
        const inp = document.getElementById('inp');
        const txt = inp.value.trim();
        if(!txt) return;
        addMsg('user', txt);
        inp.value = '';
        callAI(txt, false);
    }

    // --- ROBUST API CALLER ---
    async function callAI(text, isHidden) {
        if(!isHidden) addMsg('bot', "...");
        
        // Prepare Message
        let msgs = [...history];
        if(isHidden) {
            msgs.push({role: "user", parts: [{text: `[SYSTEM: ${text}]`}]});
        } else {
            history.push({role: "user", parts: [{text: text}]});
            msgs = [...history];
        }

        const payload = {
            contents: [{role: "user", parts: [{text: SYSTEM_PROMPT}]}, ...msgs]
        };

        let success = false;
        let replyText = "Error";

        // TRY MODELS ONE BY ONE
        for (let model of MODELS) {
            showStatus(`Trying model: ${model}...`);
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`;
                const res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                const data = await res.json();
                
                if(res.ok && data.candidates) {
                    replyText = data.candidates[0].content.parts[0].text;
                    success = true;
                    showStatus("Connected! âœ…");
                    break; // It worked! Stop trying.
                }
            } catch(e) {
                console.log(`Network error on ${model}`);
            }
        }

        // Handle Result
        if(!isHidden) {
            const list = document.getElementById('chatList');
            list.removeChild(list.lastChild); // Remove "..."
        }

        if(success) {
            addMsg('bot', replyText);
            if(!isHidden) history.push({role: "model", parts: [{text: replyText}]});
        } else {
            addMsg('bot', "âš ï¸ API Error. Key might be invalid or Project lacks API access.");
        }
    }

    function showStatus(msg) {
        const bar = document.getElementById('status-bar');
        bar.innerText = msg;
        bar.style.opacity = 1;
        setTimeout(() => bar.style.opacity = 0, 3000);
    }

</script>
</body>
</html>
