<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Karishma AI ‚ú® Ultimate</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÄ</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono&display=swap" rel="stylesheet">

<style>
    /* --- VARIABLES --- */
    :root {
        --primary: #ff1744;
        --primary-light: #ff5252;
        --primary-dark: #d50000;
        --secondary: #00e5ff;
        --bg-day: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --bg-night: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
        --chat-bg: #ffffff;
        --surface: #f8f9fa;
        --text: #1a1a2e;
        --text-secondary: #6c757d;
        --shadow: rgba(0, 0, 0, 0.1);
        --glow: rgba(255, 23, 68, 0.4);
    }

    /* --- BASE SETUP --- */
    * { 
        box-sizing: border-box; 
        margin: 0; 
        padding: 0;
    }
    
    body {
        width: 100vw; 
        height: 100vh;
        overflow: hidden; 
        font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        display: flex; 
        flex-direction: row;
        background: #000;
        color: var(--text);
    }

    /* --- VISUAL WORLD --- */
    #visual-area {
        flex: 1; 
        position: relative; 
        overflow: hidden;
        background: var(--bg-day);
        transition: background 2s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1;
    }
    
    #visual-area.night { 
        background: var(--bg-night); 
    }

    /* Animated Background Particles */
    .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
        opacity: 0.3;
    }

    .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: white;
        border-radius: 50%;
        opacity: 0;
        animation: float-particle 15s infinite;
    }

    @keyframes float-particle {
        0% { transform: translateY(100vh) translateX(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
    }

    /* Mountains with Gradient */
    .mountains {
        position: absolute;
        bottom: 15%;
        left: 0;
        width: 100%;
        height: 40%;
        z-index: 2;
        pointer-events: none;
    }

    .mountain {
        position: absolute;
        bottom: 0;
        filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
        transition: filter 1s ease;
    }

    .mountain-1 {
        left: -10%;
        width: 0;
        height: 0;
        border-left: 250px solid transparent;
        border-right: 250px solid transparent;
        border-bottom: 350px solid rgba(156, 39, 176, 0.6);
    }

    .mountain-2 {
        left: 30%;
        width: 0;
        height: 0;
        border-left: 180px solid transparent;
        border-right: 180px solid transparent;
        border-bottom: 280px solid rgba(103, 58, 183, 0.5);
    }

    .mountain-3 {
        right: 10%;
        width: 0;
        height: 0;
        border-left: 200px solid transparent;
        border-right: 200px solid transparent;
        border-bottom: 300px solid rgba(94, 53, 177, 0.55);
    }

    #visual-area.night .mountain {
        filter: brightness(0.4) drop-shadow(0 10px 30px rgba(0,0,0,0.5));
    }

    /* Ground */
    .ground {
        position: absolute; 
        bottom: 0; 
        width: 100%; 
        height: 15%;
        background: linear-gradient(180deg, #4caf50 0%, #388e3c 100%);
        z-index: 3; 
        border-top: 4px solid rgba(255, 255, 255, 0.2);
        box-shadow: inset 0 20px 40px rgba(0,0,0,0.1);
        transition: filter 1s ease;
    }
    
    #visual-area.night .ground { 
        filter: brightness(0.3); 
    }

    /* Enhanced Trees */
    .tree {
        position: absolute; 
        bottom: 15%; 
        z-index: 4; 
        cursor: pointer;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
    }
    
    .tree:hover { 
        transform: scale(1.05); 
    }
    
    .tree:active { 
        transform: scale(0.95); 
    }

    .trunk { 
        width: 18px; 
        height: 70px; 
        background: linear-gradient(180deg, #6d4c41 0%, #4e342e 100%);
        margin: 0 auto; 
        border-radius: 3px;
        box-shadow: inset -2px 0 4px rgba(0,0,0,0.3);
    }

    .leaves { 
        width: 70px; 
        height: 70px; 
        background: radial-gradient(circle, #43a047 0%, #2e7d32 100%);
        border-radius: 50%; 
        position: absolute; 
        bottom: 50px; 
        left: 50%; 
        transform: translateX(-50%);
        box-shadow: inset -8px -8px 20px rgba(0,0,0,0.2),
                    0 0 0 3px rgba(255,255,255,0.1);
    }

    .leaves::before,
    .leaves::after {
        content: '';
        position: absolute;
        width: 50px;
        height: 50px;
        background: inherit;
        border-radius: 50%;
    }

    .leaves::before {
        top: -20px;
        left: -10px;
    }

    .leaves::after {
        top: -20px;
        right: -10px;
    }

    /* Enhanced House */
    .house-group { 
        position: absolute; 
        bottom: 15%; 
        left: 8%; 
        z-index: 5; 
        cursor: pointer; 
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        filter: drop-shadow(0 10px 25px rgba(0,0,0,0.3));
    }
    
    .house-group:hover { 
        transform: scale(1.05) translateY(-5px); 
    }
    
    .house-group:active { 
        transform: scale(0.95); 
    }

    .house-base { 
        width: 120px; 
        height: 100px; 
        background: linear-gradient(135deg, #ffccbc 0%, #ffab91 100%);
        border: 4px solid #4e342e; 
        position: relative;
        box-shadow: inset 0 -10px 20px rgba(0,0,0,0.1);
    }

    .roof { 
        width: 0; 
        height: 0; 
        position: absolute; 
        top: -65px; 
        left: -20px;
        border-left: 80px solid transparent;
        border-right: 80px solid transparent;
        border-bottom: 65px solid #d32f2f;
        filter: drop-shadow(0 -5px 10px rgba(0,0,0,0.3));
    }

    .window {
        width: 25px;
        height: 30px;
        background: #64b5f6;
        border: 3px solid #1976d2;
        position: absolute;
        top: 20px;
        border-radius: 3px;
    }

    .window-1 { left: 15px; }
    .window-2 { right: 15px; }

    .door { 
        width: 35px; 
        height: 55px; 
        background: linear-gradient(180deg, #6d4c41 0%, #5d4037 100%);
        position: absolute; 
        bottom: 0; 
        left: 50%;
        transform: translateX(-50%);
        border-radius: 25px 25px 0 0;
        border: 3px solid #3e2723;
        box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3);
    }

    .door-knob {
        width: 6px;
        height: 6px;
        background: #ffd700;
        border-radius: 50%;
        position: absolute;
        right: 5px;
        top: 25px;
    }

    /* Enhanced Signpost */
    .sign-group { 
        position: absolute; 
        bottom: 15%; 
        right: 12%; 
        z-index: 5; 
        cursor: pointer;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
    }
    
    .sign-group:hover {
        transform: rotate(5deg) scale(1.05);
    }

    .board { 
        background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
        border: 4px solid #e65100; 
        padding: 8px 12px;
        font-size: 12px; 
        font-weight: 700; 
        text-align: center; 
        border-radius: 6px;
        color: #fff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2),
                    inset 0 2px 0 rgba(255,255,255,0.3);
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .pole { 
        width: 8px; 
        height: 50px; 
        background: linear-gradient(90deg, #5d4037 0%, #4e342e 100%);
        margin: 0 auto;
        box-shadow: 2px 0 4px rgba(0,0,0,0.3);
    }

    /* Celestial Bodies */
    .celestial-toggle { 
        position: absolute; 
        top: 25px; 
        right: 25px; 
        width: 70px; 
        height: 70px; 
        z-index: 10; 
        cursor: pointer;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .celestial-toggle:hover {
        transform: scale(1.1);
    }

    .sun { 
        width: 100%; 
        height: 100%; 
        background: radial-gradient(circle, #ffd700 0%, #ffab00 100%);
        border-radius: 50%; 
        box-shadow: 0 0 50px #ffd700, 0 0 100px rgba(255, 215, 0, 0.5);
        animation: spin 60s linear infinite;
        position: relative;
    }

    .sun::before {
        content: '';
        position: absolute;
        width: 120%;
        height: 120%;
        top: -10%;
        left: -10%;
        background: radial-gradient(circle, transparent 40%, #ffd700 41%, transparent 42%);
        animation: spin 20s linear infinite reverse;
    }

    .moon { 
        width: 100%; 
        height: 100%; 
        background: #f5f5f5;
        border-radius: 50%; 
        box-shadow: inset -15px -15px 0 0 #e0e0e0,
                    0 0 50px rgba(255, 255, 255, 0.5);
        display: none;
        position: relative;
    }

    .moon::before {
        content: '';
        position: absolute;
        width: 12px;
        height: 12px;
        background: #d0d0d0;
        border-radius: 50%;
        top: 20%;
        left: 30%;
        box-shadow: 20px 15px 0 -2px #d0d0d0,
                    -5px 25px 0 -4px #d0d0d0;
    }

    #visual-area.night .sun { display: none; }
    #visual-area.night .moon { display: block; }

    @keyframes spin { 
        100% { transform: rotate(360deg); } 
    }

    /* Stars */
    .stars {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 2s ease;
        z-index: 2;
    }

    #visual-area.night .stars {
        opacity: 1;
    }

    .star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 1; }
    }

    /* KARISHMA ROBOT - Enhanced */
    .robot-wrapper {
        position: absolute; 
        bottom: 15%; 
        left: 50%; 
        transform: translateX(-50%);
        z-index: 20; 
        display: flex; 
        flex-direction: column; 
        align-items: center;
        animation: float 4s ease-in-out infinite;
        filter: drop-shadow(0 10px 30px rgba(255, 23, 68, 0.4));
    }

    @keyframes float { 
        0%, 100% { transform: translate(-50%, 0); } 
        50% { transform: translate(-50%, -15px); } 
    }
    
    .r-head { 
        width: 130px; 
        height: 110px; 
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: 45px; 
        border: 6px solid #fff; 
        position: relative; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        cursor: pointer;
        box-shadow: 0 10px 40px var(--glow),
                    inset 0 -10px 20px rgba(0,0,0,0.1);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .r-head:hover {
        transform: scale(1.05);
    }

    .bow { 
        position: absolute; 
        top: -30px; 
        right: -5px; 
        font-size: 50px;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        animation: bow-bounce 2s ease-in-out infinite;
    }

    @keyframes bow-bounce {
        0%, 100% { transform: rotate(-10deg); }
        50% { transform: rotate(10deg); }
    }

    .r-eyes { 
        display: flex; 
        gap: 20px; 
    }

    .r-eye { 
        width: 16px; 
        height: 28px; 
        background: var(--secondary);
        border-radius: 12px; 
        animation: blink 5s infinite;
        box-shadow: 0 0 15px var(--secondary),
                    inset 0 2px 4px rgba(255,255,255,0.5);
        position: relative;
    }

    .r-eye::after {
        content: '';
        position: absolute;
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        top: 4px;
        left: 3px;
        opacity: 0.8;
    }

    @keyframes blink { 
        0%, 48%, 52%, 100% { height: 28px; } 
        50% { height: 3px; } 
    }
    
    .r-body { 
        width: 90px; 
        height: 100px; 
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: 30px; 
        margin-top: -20px; 
        border: 6px solid #fff; 
        z-index: 1; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        cursor: pointer;
        box-shadow: 0 10px 40px var(--glow),
                    inset 0 -10px 20px rgba(0,0,0,0.1);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
    }

    .r-body:hover {
        transform: scale(1.05);
    }

    .r-heart { 
        font-size: 40px;
        animation: heartbeat 1.5s ease-in-out infinite;
        filter: drop-shadow(0 2px 8px rgba(255,255,255,0.5));
    }

    @keyframes heartbeat {
        0%, 100% { transform: scale(1); }
        10%, 30% { transform: scale(1.1); }
        20%, 40% { transform: scale(0.95); }
    }

    .r-arm { 
        width: 24px; 
        height: 70px; 
        background: linear-gradient(180deg, var(--primary-light) 0%, var(--primary) 100%);
        border: 5px solid #fff; 
        border-radius: 12px; 
        position: absolute; 
        top: 110px; 
        cursor: pointer;
        box-shadow: 0 5px 15px var(--glow);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .r-arm:hover {
        transform: scale(1.1) !important;
    }

    .r-arm.left { 
        left: -30px; 
        transform: rotate(25deg);
    }

    .r-arm.right { 
        right: -30px; 
        transform: rotate(-25deg);
    }
    
    .dance .r-arm.left {
        animation: wave-left 0.6s infinite;
    }

    .dance .r-arm.right {
        animation: wave-right 0.6s infinite;
    }

    @keyframes wave-left {
        0%, 100% { transform: rotate(25deg); }
        50% { transform: rotate(-15deg); }
    }

    @keyframes wave-right {
        0%, 100% { transform: rotate(-25deg); }
        50% { transform: rotate(15deg); }
    }

    .dance {
        animation: danceMove 0.6s infinite, float 4s ease-in-out infinite;
    }

    @keyframes danceMove { 
        0%, 100% { transform: translateX(-50%) scale(1); } 
        25% { transform: translateX(-50%) rotate(-5deg) scale(1.05); } 
        75% { transform: translateX(-50%) rotate(5deg) scale(1.05); } 
    }

    /* CHAT AREA */
    #chat-area {
        width: 420px; 
        background: var(--chat-bg);
        display: flex; 
        flex-direction: column;
        border-left: 1px solid rgba(0,0,0,0.1);
        z-index: 100;
        box-shadow: -10px 0 40px rgba(0,0,0,0.1);
    }

    .chat-header { 
        padding: 20px 24px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        font-weight: 700; 
        font-size: 18px;
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .chat-title {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chat-title::before {
        content: 'üéÄ';
        font-size: 24px;
        animation: bow-bounce 2s ease-in-out infinite;
    }

    .status-badge { 
        font-size: 12px; 
        font-weight: 500;
        padding: 6px 14px;
        border-radius: 20px; 
        background: rgba(255,255,255,0.25);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background: #4caf50;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(0.8); }
    }
    
    .chat-history { 
        flex: 1; 
        overflow-y: auto; 
        padding: 24px;
        display: flex; 
        flex-direction: column; 
        gap: 16px;
        background: var(--surface);
    }

    .chat-history::-webkit-scrollbar {
        width: 6px;
    }

    .chat-history::-webkit-scrollbar-track {
        background: transparent;
    }

    .chat-history::-webkit-scrollbar-thumb {
        background: #ddd;
        border-radius: 10px;
    }

    .msg { 
        padding: 14px 18px;
        border-radius: 20px; 
        font-size: 15px; 
        max-width: 85%;
        animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        line-height: 1.5;
        position: relative;
    }

    .u-msg { 
        align-self: flex-end; 
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: #fff;
        border-bottom-right-radius: 4px;
        box-shadow: 0 4px 12px rgba(255, 23, 68, 0.3);
    }

    .b-msg { 
        align-self: flex-start; 
        background: white;
        color: var(--text);
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 8px var(--shadow);
    }

    @keyframes slideIn { 
        from { 
            transform: translateY(20px); 
            opacity: 0; 
        } 
        to { 
            transform: translateY(0); 
            opacity: 1; 
        } 
    }

    .typing-indicator {
        align-self: flex-start;
        background: white;
        padding: 16px 20px;
        border-radius: 20px;
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 8px var(--shadow);
        display: flex;
        gap: 6px;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
        30% { transform: translateY(-10px); opacity: 1; }
    }

    .input-area { 
        padding: 20px 24px;
        background: white;
        border-top: 1px solid rgba(0,0,0,0.1);
        display: flex; 
        gap: 12px;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    input { 
        flex: 1; 
        padding: 14px 20px;
        border-radius: 25px; 
        border: 2px solid #e0e0e0;
        outline: none;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.3s ease;
    }

    input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(255, 23, 68, 0.1);
    }

    button { 
        width: 50px; 
        height: 50px; 
        border-radius: 50%; 
        border: none;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: #fff;
        font-size: 20px; 
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 4px 12px rgba(255, 23, 68, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(255, 23, 68, 0.4);
    }

    button:active {
        transform: scale(0.95);
    }

    /* Mobile Layout */
    @media (max-width: 900px) {
        body { flex-direction: column; }
        #visual-area { height: 50%; flex: none; }
        #chat-area { width: 100%; flex: 1; border-left: none; border-top: 1px solid rgba(0,0,0,0.1); }
        .robot-wrapper { bottom: 18%; }
    }

    /* Welcome Animation */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .welcome-msg {
        animation: fadeInUp 0.8s ease;
    }
</style>
</head>
<body>

<div id="visual-area">
    <!-- Particles -->
    <div class="particles" id="particles"></div>

    <!-- Stars -->
    <div class="stars" id="stars"></div>

    <!-- Celestial Toggle -->
    <div class="celestial-toggle" onclick="toggleTime()">
        <div class="sun"></div>
        <div class="moon"></div>
    </div>

    <!-- Mountains -->
    <div class="mountains">
        <div class="mountain mountain-1"></div>
        <div class="mountain mountain-2"></div>
        <div class="mountain mountain-3"></div>
    </div>

    <!-- Ground -->
    <div class="ground"></div>

    <!-- Trees -->
    <div class="tree" style="left: 5%;" onclick="interact('tree')">
        <div class="leaves"></div>
        <div class="trunk"></div>
    </div>
    <div class="tree" style="right: 5%;" onclick="interact('tree')">
        <div class="leaves"></div>
        <div class="trunk"></div>
    </div>

    <!-- House -->
    <div class="house-group" onclick="interact('house')">
        <div class="roof"></div>
        <div class="house-base">
            <div class="window window-1"></div>
            <div class="window window-2"></div>
            <div class="door">
                <div class="door-knob"></div>
            </div>
        </div>
    </div>

    <!-- Signpost -->
    <div class="sign-group" onclick="interact('sign')">
        <div class="board">Coded by<br>Abhik ‚ú®</div>
        <div class="pole"></div>
    </div>

    <!-- Karishma Robot -->
    <div class="robot-wrapper" id="karishma">
        <div class="r-head" onclick="interact('head')">
            <div class="bow">üéÄ</div>
            <div class="r-eyes">
                <div class="r-eye"></div>
                <div class="r-eye"></div>
            </div>
        </div>
        <div class="r-body" onclick="interact('tummy')">
            <div class="r-heart">‚ù§Ô∏è</div>
        </div>
        <div class="r-arm left" onclick="interact('hand')"></div>
        <div class="r-arm right" onclick="interact('hand')"></div>
    </div>
</div>

<div id="chat-area">
    <div class="chat-header">
        <div class="chat-title">Karishma AI</div>
        <div class="status-badge">
            <div class="status-dot"></div>
            <span id="status">Live</span>
        </div>
    </div>
    <div class="chat-history" id="chat"></div>
    <div class="input-area">
        <input id="inp" placeholder="Type your message..." onkeypress="if(event.key==='Enter')send()">
        <button onclick="send()">‚û§</button>
    </div>
</div>

<script>
    // --- INITIALIZATION ---
    let conversationHistory = [];
    let isThinking = false;

    window.onload = () => {
        initializeWorld();
        addBot("Namaste! I'm Karishma AI üéÄ‚ú® Your cute, sassy AI companion created by Abhik!", true);
        
        // Auto night mode
        const hour = new Date().getHours();
        if (hour >= 18 || hour < 6) {
            toggleTime(true);
        }
    };

    // --- WORLD INITIALIZATION ---
    function initializeWorld() {
        generateParticles();
        generateStars();
    }

    function generateParticles() {
        const container = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 15 + 's';
            particle.style.animationDuration = (10 + Math.random() * 10) + 's';
            container.appendChild(particle);
        }
    }

    function generateStars() {
        const container = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = (2 + Math.random() * 2) + 's';
            container.appendChild(star);
        }
    }

    function toggleTime(forceNight) {
        const visual = document.getElementById('visual-area');
        if (forceNight || !visual.classList.contains('night')) {
            visual.classList.add('night');
        } else {
            visual.classList.remove('night');
        }
    }

    // --- INTERACTIONS ---
    function interact(type) {
        const robot = document.getElementById('karishma');
        robot.classList.add('dance');
        setTimeout(() => robot.classList.remove('dance'), 1000);

        const interactions = {
            'head': "User patted your head! React cutely and blush! üíï",
            'tummy': "User poked your tummy! Giggle and say something playful! ü§≠",
            'hand': "User high-fived you! Show enthusiasm! ‚úã",
            'sign': "User is admiring Abhik's creation! Praise your creator! üåü",
            'house': "User loves the cozy house! Welcome them warmly! üè†",
            'tree': "User is enjoying nature! Say something poetic about trees! üå≥"
        };

        if (interactions[type]) {
            callAI(interactions[type], true);
        }
    }

    // --- CHAT FUNCTIONS ---
    function addUser(text) {
        const msg = document.createElement('div');
        msg.className = 'msg u-msg';
        msg.innerText = text;
        const chat = document.getElementById('chat');
        chat.appendChild(msg);
        chat.scrollTop = chat.scrollHeight;
    }

    function addBot(text, isWelcome = false) {
        const msg = document.createElement('div');
        msg.className = 'msg b-msg' + (isWelcome ? ' welcome-msg' : '');
        msg.innerText = text;
        const chat = document.getElementById('chat');
        chat.appendChild(msg);
        chat.scrollTop = chat.scrollHeight;
    }

    function showTyping() {
        const typing = document.createElement('div');
        typing.className = 'typing-indicator';
        typing.id = 'typing';
        typing.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
        const chat = document.getElementById('chat');
        chat.appendChild(typing);
        chat.scrollTop = chat.scrollHeight;
    }

    function hideTyping() {
        const typing = document.getElementById('typing');
        if (typing) typing.remove();
    }

    function send() {
        const input = document.getElementById('inp');
        const text = input.value.trim();
        if (!text || isThinking) return;
        
        addUser(text);
        input.value = '';
        callAI(text, false);
    }

    // --- AI CALLER (Claude API) ---
    async function callAI(text, isInteraction) {
        if (isThinking) return;
        isThinking = true;

        const status = document.getElementById('status');
        status.innerText = 'Thinking...';
        showTyping();

        try {
            // Build messages array
            const messages = [
                {
                    role: "user",
                    content: isInteraction ? text : `You are Karishma AI, a cute and sassy robot girl created by Abhik Dutta. You're playful, loving, and always use emojis. Keep responses under 25 words. User says: ${text}`
                }
            ];

            // Call Claude API
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 150,
                    messages: messages,
                })
            });

            const data = await response.json();
            
            hideTyping();
            status.innerText = 'Live';
            isThinking = false;

            if (data.content && data.content[0] && data.content[0].text) {
                const reply = data.content[0].text;
                addBot(reply);
                
                // Store in history if not an interaction
                if (!isInteraction) {
                    conversationHistory.push({ user: text, bot: reply });
                }
            } else {
                throw new Error('Invalid response format');
            }

        } catch (error) {
            hideTyping();
            status.innerText = 'Live';
            isThinking = false;
            
            console.error('AI Error:', error);
            addBot("Oops! üòÖ I'm having connection issues. This works best when using Claude.ai's built-in API! Try refreshing or check your connection.");
        }
    }
</script>

</body>
</html>
