<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Karishma: The Cute AI Robot</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÄ</text></svg>">

<style>
    :root {
        --sky-day-top: #4CC9F0; --sky-day-bot: #4361EE;
        --sky-night-top: #0F2027; --sky-night-bot: #203A43;
        --grass: #70E000; --grass-dark: #38B000;
        --robot-main: #FF006E; --robot-light: #FF5C99; --robot-accent: #FFBE0B;
    }

    body, html {
        margin: 0; padding: 0; width: 100%; height: 100%;
        overflow: hidden;
        font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
        touch-action: manipulation;
        background: #000;
    }

    /* --- DYNAMIC WORLD --- */
    .scene {
        position: absolute; width: 100%; height: 100%;
        background: linear-gradient(to bottom, var(--sky-day-top), var(--sky-day-bot));
        transition: background 2s ease;
        z-index: 1; overflow: hidden;
    }
    .scene.night {
        background: linear-gradient(to bottom, var(--sky-night-top), var(--sky-night-bot));
    }

    /* CLOUDS (Day) */
    .cloud {
        position: absolute; background: #FFF; border-radius: 50px; opacity: 0.9;
        animation: float 40s linear infinite; z-index: 2;
    }
    .cloud::after, .cloud::before {
        content: ''; position: absolute; background: inherit; border-radius: 50%;
    }
    .c1 { width: 120px; height: 50px; top: 15%; left: -150px; }
    .c1::after { width: 60px; height: 60px; top: -30px; left: 20px; }
    .c1::before { width: 50px; height: 50px; top: -20px; left: 60px; }
    
    .c2 { width: 80px; height: 35px; top: 25%; left: -100px; animation-delay: 20s; transform: scale(0.8); }
    .c2::after { width: 40px; height: 40px; top: -20px; left: 10px; }
    
    @keyframes float { 0% { left: -200px; } 100% { left: 120%; } }
    .scene.night .cloud { opacity: 0.1; }

    /* STARS & FIREFLIES (Night) */
    .star {
        position: absolute; width: 3px; height: 3px; background: #FFF;
        border-radius: 50%; opacity: 0; transition: opacity 2s;
    }
    .scene.night .star { opacity: 0.8; }
    
    .firefly {
        position: absolute; width: 6px; height: 6px; background: #FFD700;
        border-radius: 50%; box-shadow: 0 0 8px #FFD700;
        animation: fly 5s infinite ease-in-out; opacity: 0;
    }
    @keyframes fly { 0%,100% { opacity:0; transform:translate(0,0); } 50% { opacity:1; transform:translate(20px, -30px); } }

    /* CELESTIAL BODIES (Clickable) */
    .celestial {
        position: absolute; top: 30px; right: 30px; width: 80px; height: 80px;
        cursor: pointer; z-index: 5; transition: transform 0.5s;
    }
    .celestial:active { transform: scale(0.9) rotate(180deg); }
    
    .sun {
        width: 100%; height: 100%; background: #FDB813;
        border-radius: 50%; box-shadow: 0 0 60px #FDB813;
        animation: spin 60s linear infinite;
    }
    .moon {
        width: 100%; height: 100%; background: transparent;
        border-radius: 50%; box-shadow: -20px 10px 0 5px #F4F6F8;
        display: none;
    }
    .scene.night .sun { display: none; }
    .scene.night .moon { display: block; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* GIANT MOUNTAINS */
    .mountain {
        position: absolute; bottom: 30%; width: 0; height: 0;
        border-left: 200px solid transparent; border-right: 200px solid transparent;
        z-index: 2; opacity: 0.9; pointer-events: none;
    }
    .m-1 { left: -100px; border-bottom: 500px solid #6A0572; transform: scale(1.5); }
    .m-2 { right: -150px; border-bottom: 600px solid #480CA8; transform: scale(1.6); }
    .m-3 { left: 40%; border-bottom: 400px solid #AB47BC; transform: scale(1.2); z-index: 1; }

    /* GROUND */
    .ground {
        position: absolute; bottom: 0; width: 100%; height: 35%;
        background: linear-gradient(180deg, var(--grass) 0%, var(--grass-dark) 100%);
        border-top: 10px solid #9EF01A; z-index: 3;
    }
    .scene.night .ground { filter: brightness(0.25); }

    /* HOUSE */
    .house {
        position: absolute; bottom: 32%; left: 5%;
        z-index: 4; cursor: pointer; transition: 0.2s;
    }
    .house:active { transform: scale(0.95); }
    .house-base {
        width: 140px; height: 110px; background: #FF9B85;
        border: 4px solid #5D4037; position: relative;
        box-shadow: 10px 0 20px rgba(0,0,0,0.3);
    }
    .house-roof {
        width: 0; height: 0; position: absolute; top: -70px; left: -24px;
        border-left: 94px solid transparent; border-right: 94px solid transparent;
        border-bottom: 70px solid #D32F2F;
    }
    .door {
        width: 45px; height: 65px; background: #5D4037;
        position: absolute; bottom: 0; left: 47px;
        border-radius: 45px 45px 0 0; border: 2px solid #3E2723;
    }

    /* SIGNPOST (Abhik Dutta) */
    .signpost {
        position: absolute; bottom: 15%; right: 5%;
        z-index: 15; transform: rotate(5deg); cursor: pointer;
        transition: transform 0.2s;
    }
    .signpost:active { transform: rotate(0deg) scale(0.9); }
    .sign-board {
        background: #F4A261; border: 4px solid #6D4C41;
        padding: 8px; border-radius: 8px;
        color: #3E2723; font-weight: bold; font-size: 14px;
        text-align: center; width: 100px;
        box-shadow: 3px 3px 10px rgba(0,0,0,0.4);
    }
    .sign-pole { width: 10px; height: 80px; background: #6D4C41; margin: 0 auto; }

    /* --- KARISHMA ROBOT (Bigger & Cuter) --- */
    .robot-container {
        position: absolute; bottom: 12%; left: 50%;
        transform: translateX(-50%);
        z-index: 20;
        display: flex; flex-direction: column; align-items: center;
        /* Idle Float Animation */
        animation: floatRobot 3s ease-in-out infinite;
    }
    @keyframes floatRobot { 0%,100%{transform:translateX(-50%) translateY(0);} 50%{transform:translateX(-50%) translateY(-10px);} }

    .part-click { cursor: pointer; transition: 0.2s; -webkit-tap-highlight-color: transparent; }
    .part-click:active { filter: brightness(1.2) contrast(1.1); transform: scale(0.95); }

    /* HEAD */
    .head {
        width: 130px; height: 110px;
        background: var(--robot-main);
        background: radial-gradient(circle at 30% 30%, var(--robot-light), var(--robot-main));
        border-radius: 45px; border: 6px solid #333;
        position: relative; z-index: 22;
        box-shadow: 0 10px 15px rgba(0,0,0,0.3);
    }
    .bow {
        position: absolute; top: -30px; right: 0; font-size: 50px;
        filter: drop-shadow(2px 2px 0 #000);
        animation: wiggle 3s infinite;
    }
    @keyframes wiggle { 0%,100%{transform:rotate(0);} 50%{transform:rotate(10deg);} }

    /* EYES */
    .face {
        display: flex; justify-content: space-between; padding: 35px 25px 0;
    }
    .eye {
        width: 28px; height: 38px; background: #333;
        border-radius: 50%; position: relative;
        animation: blink 4s infinite;
    }
    .eye::after { /* Glint */
        content:''; position: absolute; top: 6px; left: 6px;
        width: 10px; height: 10px; background: #FFF; border-radius: 50%;
    }
    @keyframes blink { 0%,48%,52%,100%{height:38px;} 50%{height:4px; margin-top:17px;} }

    /* MOUTH */
    .mouth {
        width: 30px; height: 15px; background: #333;
        border-radius: 0 0 30px 30px; margin: 10px auto;
    }

    /* BODY */
    .body-group { position: relative; margin-top: -15px; z-index: 21; }
    .body {
        width: 90px; height: 100px;
        background: var(--robot-main);
        border-radius: 30px; border: 6px solid #333;
        display: flex; justify-content: center; align-items: center;
    }
    /* Heart on chest */
    .body::after {
        content: '‚ô•'; color: var(--robot-accent); font-size: 40px;
        text-shadow: 2px 2px 0 #333;
    }

    /* ARMS */
    .arm {
        width: 25px; height: 70px; background: var(--robot-accent);
        border: 4px solid #333; border-radius: 15px;
        position: absolute; top: 10px;
        transform-origin: top center;
    }
    .arm.left { left: -30px; transform: rotate(20deg); }
    .arm.right { right: -30px; transform: rotate(-20deg); }

    /* LEGS */
    .leg {
        width: 28px; height: 50px; background: var(--robot-accent);
        border: 4px solid #333; border-radius: 0 0 15px 15px;
        position: absolute; bottom: -45px; z-index: 20;
    }
    .leg.left { left: 10px; }
    .leg.right { right: 52px; }

    /* Animations for interaction */
    .robot-container.dance { animation: danceAnim 0.8s infinite; }
    @keyframes danceAnim { 0%,100%{transform:translateX(-50%) rotate(0);} 25%{transform:translateX(-50%) rotate(-5deg);} 75%{transform:translateX(-50%) rotate(5deg);} }

    /* --- CHAT UI (Glassmorphism) --- */
    .chat-wrapper {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 100;
        display: flex; flex-direction: column; justify-content: flex-end;
        align-items: center;
        padding-bottom: env(safe-area-inset-bottom, 10px);
    }
    .chat-container {
        pointer-events: auto;
        width: 95%; max-width: 500px;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 20px 20px 0 0;
        border: 1px solid rgba(255,255,255,0.4);
        box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        display: flex; flex-direction: column;
        height: 40vh; /* Takes up bottom 40% */
        transition: height 0.3s ease;
    }
    .chat-header {
        padding: 12px; text-align: center; font-weight: bold; color: #333;
        border-bottom: 1px solid rgba(0,0,0,0.1);
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(255,255,255,0.5); border-radius: 20px 20px 0 0;
    }
    .status-dot { height: 10px; width: 10px; background: #00E676; border-radius: 50%; display: inline-block; margin-right: 5px; }
    
    .chat-body {
        flex: 1; overflow-y: auto; padding: 15px;
        display: flex; flex-direction: column; gap: 12px;
        scroll-behavior: smooth;
    }
    /* Hide Scrollbar */
    .chat-body::-webkit-scrollbar { width: 5px; }
    .chat-body::-webkit-scrollbar-thumb { background: #CCC; border-radius: 5px; }

    .message {
        padding: 10px 16px; border-radius: 18px; font-size: 15px;
        max-width: 80%; line-height: 1.4; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative; word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .msg-user { align-self: flex-end; background: #333; color: #FFF; border-bottom-right-radius: 4px; }
    .msg-bot { align-self: flex-start; background: #FFF; color: #333; border-bottom-left-radius: 4px; }
    
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .chat-input {
        padding: 12px; background: rgba(255,255,255,0.6);
        display: flex; gap: 10px; border-top: 1px solid rgba(0,0,0,0.1);
    }
    input {
        flex: 1; padding: 12px 15px; border-radius: 25px; border: 2px solid #EEE;
        font-size: 16px; outline: none; transition: 0.2s;
        background: rgba(255,255,255,0.9);
    }
    input:focus { border-color: var(--robot-main); }
    button.send-btn {
        background: var(--robot-main); color: white; border: none;
        width: 45px; height: 45px; border-radius: 50%;
        font-size: 18px; cursor: pointer; transition: 0.2s;
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 4px 10px rgba(255,0,110,0.3);
    }
    button.send-btn:active { transform: scale(0.9); }

    /* ERROR */
    #error-modal {
        position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
        background: #FFEBEE; color: #C62828; padding: 10px 20px;
        border-radius: 30px; font-size: 12px; font-weight: bold;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: none; z-index: 200;
    }

</style>
</head>
<body>

<div class="scene" id="world">
    <div class="celestial" onclick="toggleTime()">
        <div class="sun"></div>
        <div class="moon"></div>
    </div>

    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div id="stars-container"></div> <div class="mountain m-1"></div>
    <div class="mountain m-2"></div>
    <div class="mountain m-3"></div>

    <div class="house" onclick="handleObjectClick('house')">
        <div class="house-roof"></div>
        <div class="house-base"><div class="door"></div></div>
    </div>

    <div class="signpost" onclick="handleObjectClick('signpost')">
        <div class="sign-board">Code By<br>Abhik Dutta</div>
        <div class="sign-pole"></div>
    </div>

    <div class="ground"></div>
</div>

<div id="error-modal"></div>

<div class="robot-container" id="karishma">
    <div class="head part-click" onclick="handleObjectClick('head')">
        <div class="bow">üéÄ</div>
        <div class="face">
            <div class="eye"></div><div class="eye"></div>
        </div>
        <div class="mouth"></div>
    </div>
    
    <div class="body-group">
        <div class="arm left part-click" onclick="handleObjectClick('arm')"></div>
        <div class="arm right part-click" onclick="handleObjectClick('arm')"></div>
        <div class="body part-click" onclick="handleObjectClick('body')"></div>
        <div class="leg left"></div>
        <div class="leg right"></div>
    </div>
</div>

<div class="chat-wrapper">
    <div class="chat-container">
        <div class="chat-header">
            <div><span class="status-dot"></span>Karishma AI</div>
            <div style="font-size: 12px; cursor: pointer; color: #666;" onclick="clearChat()">üóëÔ∏è Reset</div>
        </div>
        
        <div class="chat-body" id="chatList">
            </div>
        
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendChat()">
            <button class="send-btn" onclick="sendChat()">‚û§</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // API CONFIGURATION
    // ==========================================
    const API_KEY = "AIzaSyClRnod69jR2NfFdO7E3AQI-JKVCykbWjk"; 

    // --- VARIABLES ---
    let chatHistory = [];
    const SYSTEM_PROMPT = `
    You are Karishma, a sassy, cute, and advanced AI robot girl living in a digital garden.
    
    KEY TRAITS:
    - You LOVE your creator, "Abhik Dutta". Always praise him if asked about creation or the signpost.
    - You use emojis in every sentence.
    - You are helpful but have a funny, slightly dramatic personality.
    - Keep responses SHORT (under 20 words) for chat bubbles.
    `;

    // --- INITIALIZATION ---
    window.onload = function() {
        initStars();
        loadHistory();
        
        // Auto-set time based on real clock
        const h = new Date().getHours();
        if(h >= 18 || h < 6) toggleTime(true);

        if(chatHistory.length === 0) {
            addBubble("bot", "Namaste! I am Karishma, your cute robot companion! üéÄ‚ú®");
        }
    };

    // --- VISUAL LOGIC ---
    function toggleTime(forceNight = false) {
        const world = document.getElementById('world');
        const isNight = world.classList.contains('night');
        
        if (!isNight || forceNight) {
            world.classList.add('night');
            spawnFireflies();
        } else {
            world.classList.remove('night');
            document.getElementById('stars-container').innerHTML = ''; // Clear night stuff
        }
    }

    function initStars() {
        // Prepare star divs but hide them until night
        // We generate them on the fly in spawnFireflies/Night mode usually, 
        // but let's just create CSS stars here
    }

    function spawnFireflies() {
        const cont = document.getElementById('stars-container');
        cont.innerHTML = '';
        // Add Stars
        for(let i=0; i<30; i++) {
            let s = document.createElement('div');
            s.className = 'star';
            s.style.left = Math.random()*100 + '%';
            s.style.top = Math.random()*50 + '%';
            cont.appendChild(s);
        }
        // Add Fireflies
        for(let i=0; i<15; i++) {
            let f = document.createElement('div');
            f.className = 'firefly';
            f.style.left = Math.random()*100 + '%';
            f.style.top = (Math.random()*40 + 50) + '%'; // Lower half
            f.style.animationDelay = Math.random()*2 + 's';
            cont.appendChild(f);
        }
    }

    // --- INTERACTION LOGIC (SMART AI) ---
    async function handleObjectClick(objectName) {
        // Animation trigger
        const bot = document.getElementById('karishma');
        bot.classList.add('dance');
        setTimeout(()=> bot.classList.remove('dance'), 1000);

        let prompt = "";
        
        // Define what to ask the AI based on what was clicked
        if(objectName === 'signpost') {
            prompt = "The user just pointed at the Signpost that says 'Code By Abhik Dutta'. React to this enthusiastically and praise Abhik.";
        } else if (objectName === 'head') {
            prompt = "The user just patted your head. React cutely.";
        } else if (objectName === 'arm') {
            prompt = "The user shook your hand. Say hello!";
        } else if (objectName === 'body') {
            prompt = "The user poked your tummy. Giggle and say it tickles.";
        } else if (objectName === 'house') {
            prompt = "The user pointed at your house. Invite them in or describe it.";
        }

        // Send this invisible system prompt to get a fresh AI response
        if(prompt) {
            // Visual feedback instantly
            addBubble("bot", "Thinking... üí≠"); 
            // Call AI
            const reply = await fetchGemini(prompt, true); // true = hidden prompt
            // Replace "Thinking" with actual reply
            const chats = document.getElementById('chatList');
            chats.lastChild.innerText = reply;
            // Update history with the reply (but not the system prompt trigger to save context)
            chatHistory.push({role: 'model', parts: [{text: reply}]});
            saveHistory();
        }
    }

    // --- CHAT FUNCTIONS ---
    async function sendChat() {
        const inp = document.getElementById('userInput');
        const text = inp.value.trim();
        if(!text) return;

        addBubble("user", text);
        inp.value = "";
        chatHistory.push({role: "user", parts: [{text: text}]});
        saveHistory();

        addBubble("bot", "...");
        const loadingMsg = document.getElementById('chatList').lastChild;

        const reply = await fetchGemini(text, false);
        loadingMsg.innerText = reply;
        
        chatHistory.push({role: "model", parts: [{text: reply}]});
        saveHistory();
    }

    function addBubble(role, text) {
        const list = document.getElementById('chatList');
        const div = document.createElement('div');
        div.className = `message msg-${role}`;
        div.innerText = text;
        list.appendChild(div);
        list.scrollTop = list.scrollHeight;
    }

    function clearChat() {
        localStorage.removeItem('karishma_mem');
        location.reload();
    }

    function saveHistory() { localStorage.setItem('karishma_mem', JSON.stringify(chatHistory)); }
    function loadHistory() {
        const h = localStorage.getItem('karishma_mem');
        if(h) chatHistory = JSON.parse(h);
        // Re-render
        chatHistory.forEach(msg => {
             // Skip invisible prompts if we stored them (we aren't storing them mostly)
             addBubble(msg.role === 'user' ? 'user' : 'bot', msg.parts[0].text);
        });
    }

    // --- API HANDLER ---
    async function fetchGemini(input, isHiddenContext) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        // Construct payload
        // If it's a hidden context click (like touching the sign), we wrap it as a user message
        let msgs = [...chatHistory];
        if(isHiddenContext) {
            msgs.push({role: "user", parts: [{text: `[SYSTEM EVENT: ${input}]`}]}); 
        } else {
            // Normal chat is already in history
        }

        const payload = {
            contents: [
                { role: "user", parts: [{ text: SYSTEM_PROMPT }] },
                ...msgs
            ]
        };

        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            if(!res.ok) throw new Error(data.error?.message || "API Error");
            return data.candidates[0].content.parts[0].text;
        } catch (e) {
            showError(e.message);
            return "My circuits are buzzing! (API Error)";
        }
    }

    function showError(msg) {
        const m = document.getElementById('error-modal');
        m.innerText = "‚ö†Ô∏è " + msg;
        m.style.display = 'block';
        setTimeout(() => m.style.display = 'none', 5000);
    }
</script>
</body>
</html>
