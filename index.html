<!-- KARISHMA AI - FIXED + ENHANCED VERSION -->
<!-- Creator: Abhik Dutta -->
<!-- Gemini API Fixed | UI Enhanced | World Expanded -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Karishma AI: Live</title>

<style>
/* ---------------- VARIABLES ---------------- */
:root{
--sky-day: linear-gradient(180deg,#4facfe,#00f2fe);
--sky-night: linear-gradient(180deg,#0f2027,#203a43,#2c5364);
--robot-main:#ff4081;
--chat-bg:#ffffff;
--glow:#ff80ab;
}

/* ---------------- BASE ---------------- */
*{box-sizing:border-box}
body{
margin:0;height:100vh;width:100vw;
display:flex;
font-family:'Segoe UI',sans-serif;
overflow:hidden;
background:#000;
}

/* ---------------- LAYOUT ---------------- */
#visual-area{
flex:1;position:relative;
background:var(--sky-day);
transition:1.5s;
overflow:hidden;
}
#visual-area.night{background:var(--sky-night)}

#chat-area{
width:380px;
background:var(--chat-bg);
display:flex;flex-direction:column;
border-left:1px solid #ddd;
box-shadow:-5px 0 20px rgba(0,0,0,.15);
z-index:10;
}

/* Mobile */
@media(max-width:800px){
body{flex-direction:column}
#visual-area{height:55%}
#chat-area{width:100%}
}

/* ---------------- WORLD OBJECTS ---------------- */
.ground{
position:absolute;bottom:0;width:100%;height:12%;
background:#76b852;border-top:6px solid #6fa148;z-index:3;
}

/* Trees */
.tree{
position:absolute;bottom:12%;width:60px;height:120px;
background:#5d4037;border-radius:10px;
}
.tree::after{
content:"";position:absolute;bottom:80px;left:-40px;
width:140px;height:100px;border-radius:50%;
background:#2e7d32;
}

/* Pond */
.pond{
position:absolute;bottom:12%;left:35%;
width:200px;height:60px;
background:rgba(0,150,255,.4);
border-radius:50%;
filter:blur(1px);
}

/* Butterflies */
.butterfly{
position:absolute;font-size:18px;
animation:fly 12s linear infinite;
}
@keyframes fly{
0%{transform:translate(-50px,0)}
100%{transform:translate(120vw,-100px)}
}

/* Fireflies */
.firefly{
position:absolute;width:6px;height:6px;
background:#fff;border-radius:50%;
opacity:0;animation:glow 4s infinite;
}
@keyframes glow{
0%,100%{opacity:0}
50%{opacity:1}
}

/* ---------------- ROBOT ---------------- */
.robot-wrapper{
position:absolute;bottom:12%;left:50%;
transform:translateX(-50%);
display:flex;flex-direction:column;align-items:center;
animation:float 4s ease-in-out infinite;
z-index:20;
filter:drop-shadow(0 0 15px rgba(255,64,129,.4));
}
@keyframes float{
0%,100%{transform:translate(-50%,0)}
50%{transform:translate(-50%,-12px)}
}

.r-head{
width:110px;height:90px;
background:var(--robot-main);
border-radius:35px;border:5px solid #fff;
display:flex;align-items:center;justify-content:center;
position:relative;
}
.bow{position:absolute;top:-25px;right:-5px;font-size:40px}

.r-eye{
width:14px;height:24px;background:#00e5ff;
border-radius:10px;margin:0 10px;
animation:blink 4s infinite;
box-shadow:0 0 10px #00e5ff;
}
@keyframes blink{
0%,48%,52%,100%{height:24px}
50%{height:3px}
}

.r-body{
width:75px;height:85px;margin-top:-15px;
background:var(--robot-main);
border-radius:25px;border:5px solid #fff;
display:flex;align-items:center;justify-content:center;
}

.r-arm{
width:20px;height:60px;background:#ff80ab;
border:4px solid #fff;border-radius:10px;
position:absolute;top:95px;
}
.r-arm.left{left:-25px;transform:rotate(25deg)}
.r-arm.right{right:-25px;transform:rotate(-25deg)}

.dance{animation:dance .6s infinite}
@keyframes dance{
0%{transform:translate(-50%,0) rotate(0)}
50%{transform:translate(-50%,0) rotate(6deg)}
100%{transform:translate(-50%,0) rotate(-6deg)}
}

/* ---------------- CHAT ---------------- */
.chat-header{
padding:15px;font-weight:bold;
display:flex;justify-content:space-between;
border-bottom:1px solid #eee;
}

.status-badge{
font-size:11px;padding:4px 10px;border-radius:20px;
background:#e8f5e9;color:#2e7d32;
}

.chat-history{
flex:1;overflow-y:auto;padding:15px;
display:flex;flex-direction:column;gap:10px;
scroll-behavior:smooth;
}

.msg{
padding:12px 15px;border-radius:18px;
max-width:85%;animation:pop .3s;
}
.u-msg{align-self:flex-end;background:#ff4081;color:#fff}
.b-msg{align-self:flex-start;background:#fff;border:1px solid #eee}

@keyframes pop{
from{transform:scale(.8);opacity:0}
to{transform:scale(1);opacity:1}
}

.input-area{
padding:12px;display:flex;gap:10px;border-top:1px solid #eee;
}
input{
flex:1;padding:12px;border-radius:25px;border:1px solid #ddd;
}
button{
width:45px;height:45px;border-radius:50%;
border:none;background:#ff4081;color:#fff;font-size:18px;
cursor:pointer;
}

/* ---------------- NIGHT EFFECT ---------------- */
#visual-area.night{filter:brightness(.85)}
</style>
</head>

<body>

<div id="visual-area">
<div class="pond"></div>

<div class="tree" style="left:5%"></div>
<div class="tree" style="right:8%"></div>

<div class="butterfly" style="top:20%;left:-50px">ü¶ã</div>
<div class="butterfly" style="top:40%;left:-150px;animation-delay:5s">ü¶ã</div>

<div class="robot-wrapper" id="karishma">
<div class="r-head" onclick="interact('head')">
<div class="bow">üéÄ</div>
<div style="display:flex">
<div class="r-eye"></div>
<div class="r-eye"></div>
</div>
</div>

<div class="r-body" onclick="interact('tummy')">‚ù§Ô∏è</div>
<div class="r-arm left" onclick="interact('hand')"></div>
<div class="r-arm right" onclick="interact('hand')"></div>
</div>

<div class="ground"></div>
</div>

<div id="chat-area">
<div class="chat-header">
<div>Karishma AI</div>
<div class="status-badge" id="status">‚óè Live</div>
</div>

<div class="chat-history" id="chat"></div>

<div class="input-area">
<input id="inp" placeholder="Talk to Karishma..." 
onkeypress="if(event.key==='Enter')send()">
<button onclick="send()">‚û§</button>
</div>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const API_KEY="AIzaSyDqcavif5UfWGLY1w7YCmR-Oi2Anz9GloU";

const MODELS=[
"models/gemini-1.5-flash",
"models/gemini-1.5-pro"
];

const SYSTEM_PROMPT=`You are Karishma AI.
Cute, playful, sassy, emotional robot girl.
Creator: Abhik Dutta.
Replies must be short, sweet, fun, max 18 words.
Use emojis.
Personality: loving, funny, smart, flirty cute, positive.`;

/* ---------------- STATE ---------------- */
let history=[];

/* ---------------- INIT ---------------- */
window.onload=()=>{
addBot("Namaste! I'm Karishma AI üéÄüíñ");
generateFireflies();
}

/* ---------------- UI ---------------- */
function addUser(t){
const d=document.createElement("div");
d.className="msg u-msg";
d.innerText=t;
chat.appendChild(d);
chat.scrollTop=chat.scrollHeight;
}

function addBot(t){
const d=document.createElement("div");
d.className="msg b-msg";
d.innerText=t;
chat.appendChild(d);
chat.scrollTop=chat.scrollHeight;
}

/* ---------------- INTERACTION ---------------- */
function interact(type){
const r=document.getElementById("karishma");
r.classList.add("dance");
setTimeout(()=>r.classList.remove("dance"),800);

let t="";
if(type==="head")t="User patted your head. React cutely.";
if(type==="tummy")t="User poked your tummy. Giggle.";
if(type==="hand")t="User high-fived you. Be happy.";

callAI(t,true);
}

/* ---------------- SEND ---------------- */
function send(){
const v=inp.value.trim();
if(!v)return;
addUser(v);
inp.value="";
callAI(v,false);
}

/* ---------------- AI CORE ---------------- */
async function callAI(text,hidden){
status.innerText="Thinking...";

let contents=[
{role:"user",parts:[{text:SYSTEM_PROMPT}]},
...history,
{role:"user",parts:[{text:text}]}
];

const payload={contents};

let reply=null;

for(let m of MODELS){
try{
const res=await fetch(`https://generativelanguage.googleapis.com/v1/${m}:generateContent?key=${API_KEY}`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});
const data=await res.json();

if(data.candidates){
reply=data.candidates[0].content.parts[0].text;
break;
}
}catch(e){}
}

status.innerText="‚óè Live";

if(reply){
addBot(reply);
if(!hidden){
history.push({role:"user",parts:[{text:text}]});
history.push({role:"model",parts:[{text:reply}]});
}
}else{
addBot("Aww‚Ä¶ I'm sleepy üò¥ Try again later üíï");
}
}

/* ---------------- EFFECTS ---------------- */
function generateFireflies(){
for(let i=0;i<15;i++){
let f=document.createElement("div");
f.className="firefly";
f.style.left=Math.random()*100+"%";
f.style.top=Math.random()*60+"%";
f.style.animationDelay=Math.random()*5+"s";
visual-area.appendChild(f);
}
}
</script>

</body>
</html>
