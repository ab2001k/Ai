<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bella: The Sassy Garden Bot</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÄ</text></svg>">

<style>
    /* --- 3. VIBRANT COLORS --- */
    :root {
        --sky-top: #4CC9F0;       /* Vibrant Blue */
        --sky-bot: #4361EE;       /* Deep Blue */
        --grass: #70E000;         /* Neon Green */
        --grass-dark: #38B000;    /* Rich Green */
        --robot-color: #FF006E;   /* Hot Pink */
        --robot-accent: #FFBE0B;  /* Golden Yellow */
        --bubble-bg: #FFFFFF;
    }

    body, html {
        margin: 0; padding: 0; width: 100%; height: 100%;
        overflow: hidden;
        font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; /* Comic Font */
    }

    /* --- SCENERY --- */
    .scene {
        position: absolute; width: 100%; height: 100%;
        background: linear-gradient(to bottom, var(--sky-top), var(--sky-bot));
        z-index: 1;
    }

    /* Mountains (More colorful) */
    .mountain {
        position: absolute; bottom: 30%; width: 0; height: 0;
        border-left: 150px solid transparent;
        border-right: 150px solid transparent;
        border-bottom: 250px solid #7209B7; /* Purple Mountains */
        z-index: 2; opacity: 0.8;
    }
    .m-1 { left: 10%; transform: scale(1.2); border-bottom-color: #560BAD; }
    .m-2 { left: 40%; transform: scale(0.8); border-bottom-color: #3A0CA3; }
    .m-3 { left: 70%; transform: scale(1.5); border-bottom-color: #480CA8; }

    /* Ground */
    .ground {
        position: absolute; bottom: 0; width: 100%; height: 35%;
        background: linear-gradient(to bottom, var(--grass), var(--grass-dark));
        z-index: 4;
        border-top: 8px solid #9EF01A;
    }

    /* --- THE ROBOT --- */
    .robot-container {
        position: absolute; bottom: 15%; left: 20%; /* Robot is on the LEFT now */
        z-index: 10;
        display: flex; flex-direction: column; align-items: center;
        animation: bounce 2s infinite ease-in-out;
        cursor: pointer;
    }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .head {
        width: 90px; height: 80px;
        background: var(--robot-color);
        border-radius: 30px; border: 5px solid #000;
        position: relative;
        box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
    }
    .eyes { display: flex; justify-content: space-between; padding: 25px 20px 0; }
    .eye {
        width: 15px; height: 25px; background: #FFF;
        border-radius: 50%; border: 3px solid #000;
        animation: blink 4s infinite;
    }
    .mouth {
        width: 20px; height: 10px; background: #FFF;
        border-radius: 0 0 20px 20px; margin: 5px auto;
        border: 2px solid #000;
    }
    .body {
        width: 60px; height: 70px; background: var(--robot-color);
        border-radius: 20px; margin-top: -10px; border: 5px solid #000;
        z-index: -1;
    }
    .bow { position: absolute; top: -20px; right: -10px; font-size: 40px; }

    /* --- 4. CENTERED COMIC CHAT --- */
    .chat-wrapper {
        position: absolute;
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 400px; height: 500px;
        z-index: 100;
        display: flex; flex-direction: column;
        pointer-events: none; /* Let clicks pass through to scenery */
    }

    /* Input Area (Visible & Interactive) */
    .chat-input-area {
        pointer-events: auto;
        background: #FFF; padding: 10px;
        border: 4px solid #000; border-radius: 20px;
        display: flex; gap: 10px;
        box-shadow: 8px 8px 0 #000;
        margin-top: auto; /* Push to bottom of wrapper */
    }
    input {
        flex: 1; border: 2px solid #ddd; padding: 10px; border-radius: 10px;
        font-family: inherit; font-size: 16px; outline: none;
    }
    button {
        background: var(--robot-color); color: #FFF; border: 2px solid #000;
        padding: 0 20px; border-radius: 10px; font-weight: bold; cursor: pointer;
        transition: 0.2s;
    }
    button:hover { transform: scale(1.05); }

    /* --- COMIC BUBBLES --- */
    .chat-body {
        flex: 1; overflow-y: auto; padding: 20px;
        display: flex; flex-direction: column; gap: 15px;
        /* Hide scrollbar */
        scrollbar-width: none; 
    }
    
    .message {
        pointer-events: auto;
        max-width: 80%; padding: 15px 20px;
        position: relative; font-size: 16px; line-height: 1.4;
        animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        color: #000;
    }

    /* User Bubble (Standard) */
    .msg-user {
        align-self: flex-end;
        background: #FFBE0B;
        border: 3px solid #000; border-radius: 20px 20px 0 20px;
    }

    /* Bot: Normal Talk */
    .msg-bot {
        align-self: flex-start;
        background: #FFF;
        border: 3px solid #000; border-radius: 20px 20px 20px 0;
        box-shadow: 5px 5px 0 rgba(0,0,0,0.1);
    }

    /* Bot: THOUGHT Bubble (Cloud style) */
    .msg-bot.thought {
        background: #E0F7FA;
        border: 3px dashed #0077B6;
        border-radius: 30px;
    }
    .msg-bot.thought::before { content: 'üí≠'; margin-right: 5px; }

    /* Bot: STRONG/SHOUT Bubble (Spiky) */
    .msg-bot.shout {
        background: #FF0054; color: #FFF;
        border: 4px solid #590D22;
        clip-path: polygon(0% 0%, 100% 0%, 100% 75%, 75% 75%, 75% 100%, 50% 75%, 0% 75%); /* Simple spike attempt or just aggressive border */
        /* Use CSS border trick for jagged edges instead implies complexity, lets stick to bold style */
        clip-path: none;
        border-radius: 5px;
        font-weight: 900; text-transform: uppercase;
        transform: rotate(-2deg);
    }

    /* --- 5. STATUS INDICATOR --- */
    .status-bar {
        position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
        background: #FFF; padding: 5px 15px; border-radius: 20px;
        border: 3px solid #000; font-size: 12px; font-weight: bold;
        display: flex; align-items: center; gap: 8px;
    }
    .led { width: 10px; height: 10px; border-radius: 50%; background: #ccc; border: 1px solid #000; }
    .led.on { background: #00FF00; box-shadow: 0 0 5px #00FF00; }
    .led.off { background: #FF0000; }

    /* Modal */
    #api-modal {
        position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 999;
        display: flex; justify-content: center; align-items: center;
    }
    .modal-box {
        background: #FFF; padding: 30px; border-radius: 20px; text-align: center;
        border: 5px solid var(--robot-color); width: 300px;
    }

    @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
</style>
</head>
<body>

<div id="api-modal">
    <div class="modal-box">
        <h2>üéÄ Wake Up Bella!</h2>
        <p>Enter your Google Gemini API Key:</p>
        <input type="password" id="apiKeyInput" placeholder="API Key" style="width: 90%; padding: 8px; border:2px solid #000; border-radius:5px;">
        <br><br>
        <button onclick="startGame()">WAKE UP</button>
        <p style="font-size: 10px; margin-top: 10px; color:#666;">Leave empty for Demo Mode</p>
    </div>
</div>

<div class="scene">
    <div class="mountain m-1"></div>
    <div class="mountain m-2"></div>
    <div class="mountain m-3"></div>
    
    <div class="ground">
        <div style="position: absolute; left: 10%; bottom: 20px; font-size: 40px;">üå∏</div>
        <div style="position: absolute; left: 80%; bottom: 40px; font-size: 30px;">üçÑ</div>
    </div>
</div>

<div class="robot-container">
    <div class="head">
        <div class="bow">üéÄ</div>
        <div class="eyes">
            <div class="eye"></div>
            <div class="eye"></div>
        </div>
        <div class="mouth"></div>
    </div>
    <div class="body"></div>
</div>

<div class="chat-wrapper">
    <div class="status-bar">
        <div id="statusLed" class="led"></div>
        <span id="statusText">System Offline</span>
    </div>

    <div class="chat-body" id="chatBody">
        <div class="message msg-bot">
            Hi! I'm Bella. I love vibrant colors! üåà
        </div>
    </div>

    <div class="chat-input-area">
        <input type="text" id="userInput" placeholder="Say something..." onkeypress="handleEnter(event)">
        <button onclick="sendMessage()">SEND</button>
    </div>
</div>

<script>
    /* --- 1. SYSTEM INSTRUCTION SETTING --- */
    // Edit this to change her personality!
    // We also instruct her on how to trigger styles using T: (Thought) and S: (Shout)
    const SYSTEM_INSTRUCTION = `
    You are Bella, a cute, sassy, vibrant robot girl in a garden. 
    You are full of energy and use emojis.
    
    IMPORTANT FORMATTING RULES:
    1. If you are thinking to yourself (internal monologue), start the sentence with "T: "
    2. If you are shouting, angry, or very excited, start the sentence with "S: "
    3. Otherwise, just speak normally.
    
    Example:
    User: Do you like rain?
    Response: T: My circuits hate water... S: NO WAY! I will rust! ‚òîÔ∏è
    `;

    let apiKey = "";
    let isDemoMode = false;

    function startGame() {
        const input = document.getElementById('apiKeyInput').value;
        const led = document.getElementById('statusLed');
        const statusText = document.getElementById('statusText');

        if (input.trim() === "") {
            isDemoMode = true;
            statusText.innerText = "Demo Mode";
            led.className = "led on"; 
            led.style.background = "orange";
        } else {
            apiKey = input.trim();
            statusText.innerText = "Online (Smart)";
            led.className = "led on";
        }
        document.getElementById('api-modal').style.display = 'none';
    }

    function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

    function addMessage(sender, text, style = "normal") {
        const chatBody = document.getElementById('chatBody');
        const div = document.createElement('div');
        
        // Base class
        div.className = `message msg-${sender}`;
        
        // Apply special styles (Thought / Shout)
        if (sender === 'bot') {
            if (style === 'thought') div.classList.add('thought');
            if (style === 'shout') div.classList.add('shout');
        }

        div.innerText = text;
        chatBody.appendChild(div);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    async function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text) return;

        addMessage("user", text);
        input.value = "";

        // Show typing
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'message msg-bot';
        loadingDiv.innerText = "...";
        loadingDiv.id = "loading-msg";
        document.getElementById('chatBody').appendChild(loadingDiv);

        if (isDemoMode) {
            setTimeout(() => {
                document.getElementById('loading-msg').remove();
                addMessage("bot", "I'm in demo mode! I can't really think yet. üéÄ");
            }, 1000);
        } else {
            try {
                // Call API
                const rawResponse = await fetchGeminiResponse(text);
                document.getElementById('loading-msg').remove();
                
                // Parse the response for T: and S: tags
                processBotResponse(rawResponse);

            } catch (error) {
                document.getElementById('loading-msg').remove();
                addMessage("bot", "Oops! Connection Error. üîå");
                document.getElementById('statusLed').className = "led off";
            }
        }
    }

    // --- LOGIC TO SPLIT THOUGHTS vs SHOUTS vs NORMAL ---
    function processBotResponse(response) {
        // Simple splitter based on our custom tags
        // This is a basic parser. For advanced use, we'd split by regex.
        // Here we handle the whole message as one style if it starts with the tag, 
        // or check simple containment.
        
        if (response.startsWith("T:")) {
            addMessage("bot", response.replace("T:", "").trim(), "thought");
        } else if (response.startsWith("S:")) {
            addMessage("bot", response.replace("S:", "").trim(), "shout");
        } else {
            addMessage("bot", response, "normal");
        }
    }

    async function fetchGeminiResponse(userText) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{
                parts: [{ text: SYSTEM_INSTRUCTION + "\n\nUser: " + userText }]
            }]
        };

        const res = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        
        const data = await res.json();
        return data.candidates[0].content.parts[0].text;
    }
</script>

</body>
</html>
